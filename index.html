<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzled.org — Auto Game Scanner</title>

<style>
/* ---------- THEMES ---------- */
:root {
  --bg: #0a0a0f;
  --card: #11151f;
  --text: #eee;
  --accent: #4da3ff;
  --glass: rgba(255,255,255,0.05);
  --border: rgba(255,255,255,0.08);
  --blur: blur(8px);
}

body.neon {
  --bg: #02030e;
  --card: #03051a;
  --text: #7df9ff;
  --accent: #00eaff;
}

body.glass {
  --bg: #0a0a0a;
  --card: rgba(255,255,255,0.15);
  --text: #fff;
  --accent: #80c0ff;
  --border: rgba(255,255,255,0.2);
  --blur: blur(16px);
}

/* ---------- GENERAL UI ---------- */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  text-align: center;
  padding: 20px;
  font-size: 30px;
  font-weight: bold;
}

#loader {
  width: 100%;
  text-align: center;
  font-size: 18px;
  margin-top: 20px;
}

.progress {
  width: 80%;
  margin: 10px auto;
  height: 20px;
  background: #333;
  border-radius: 8px;
  overflow: hidden;
}
.bar {
  height: 100%;
  width: 0%;
  background: var(--accent);
  transition: width 0.1s;
}

/* ---------- GAME GRID ---------- */
#games {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
  gap: 18px;
  padding: 20px;
}

.game-card {
  background: var(--card);
  border: 1px solid var(--border);
  padding: 15px;
  border-radius: 12px;
  cursor: pointer;
  backdrop-filter: var(--blur);
  transition: 0.2s;
}
.game-card:hover {
  transform: scale(1.05);
  border-color: var(--accent);
}

.game-logo {
  width: 100%;
  height: 120px;
  background: #000;
  border-radius: 10px;
  margin-bottom: 10px;
  object-fit: contain;
}

/* ---------- SETTINGS PANEL ---------- */
#panel {
  position: fixed;
  top: 0; right: 0;
  width: 300px;
  height: 100vh;
  background: var(--card);
  border-left: 1px solid var(--border);
  padding: 15px;
  overflow-y: auto;
}
input, button, select {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border: none;
  border-radius: 8px;
}
button {
  background: var(--accent);
  color: #000;
  font-weight: bold;
}
</style>
</head>

<body class="dark">
<header>Puzzled.org — Auto Game Scanner</header>

<div id="loader">Scanning games…</div>
<div class="progress"><div class="bar" id="progressBar"></div></div>

<div id="games"></div>

<!-- SETTINGS PANEL -->
<div id="panel">
  <h3>Settings</h3>
  <select id="themeSelect">
    <option value="dark">Dark</option>
    <option value="neon">Neon</option>
    <option value="glass">Glass</option>
  </select>

  <button id="stopScan">Stop Scan</button>
  <button id="rescan">Rescan</button>
  <button id="clearDB">Reset Database</button>
</div>

<script>
/* ================================================================
     WORKER CODE — Encoded as a Blob so no worker.js file needed!
================================================================ */
const workerCode = `
self.onmessage = async e=>{
  const {file} = e.data;
  try{
    const r = await fetch(file,{method:'HEAD'});
    if(r.ok){ self.postMessage({found:true,file}); }
    else    { self.postMessage({found:false}); }
  }catch(err){ self.postMessage({found:false}); }
};
`;

const workerBlob = new Blob([workerCode], {type: "application/javascript"});
const workerURL = URL.createObjectURL(workerBlob);

/* ================================================================
     MAIN SCANNER LOGIC
================================================================ */
const exts = [".html",".htm",".zip",".js",".wasm"];
const alphabet = "abcdefghijklmnopqrstuvwxyz0123456789-_";
let scanning = true;
const maxLength = 12;      // brute force length
const THREADS = 8;
const workers = [];

const db = JSON.parse(localStorage.getItem("puzzledDB") || "{}");
function saveDB(){ localStorage.setItem("puzzledDB", JSON.stringify(db)); }

function generateNames() {
  const out = ["index","game","play","start","main","run"];
  for (let i=0; i<alphabet.length; i++) {
    for (let j=0; j<alphabet.length; j++) {
      out.push(alphabet[i] + alphabet[j]);
    }
  }
  return out;
}

const names = generateNames();
const totalChecks = names.length * exts.length;
let completed = 0;

function updateProgress(){
  const pct = (completed / totalChecks) * 100;
  progressBar.style.width = pct + "%";
  loader.innerText = `Scanning… ${Math.floor(pct)}%`;
}

function detectLogo(gameURL){
  return gameURL.replace(/\.(html|htm|js|zip|wasm)$/,"") + ".png";
}

function addGameCard(name, url){
  if(db[name]?.hidden) return;

  const card = document.createElement("div");
  card.className = "game-card";

  const img = document.createElement("img");
  img.className = "game-logo";
  img.src = detectLogo(url);
  img.onerror = ()=>{ img.style.display="none"; };

  const title = document.createElement("div");
  title.innerText = name;

  card.appendChild(img);
  card.appendChild(title);

  card.onclick = ()=>{
    localStorage.setItem("lastGame", url);
    window.location.href = url;
  };

  games.appendChild(card);
}

async function startScan(){
  scanning = true;

  // create workers
  for(let i=0;i<THREADS;i++){
    const w = new Worker(workerURL);
    w.onmessage = msg=>{
      const {found, file} = msg.data;

      completed++;
      updateProgress();

      if(found){
        const gameName = file.split("/").pop();
        db[gameName] = db[gameName] || {name:gameName, url:file};
        saveDB();
        addGameCard(gameName, file);
      }
    };
    workers.push(w);
  }

  let index = 0;

  async function dispatch(){
    if(!scanning) return;

    for(let w of workers){
      if(index >= names.length) return;

      const base = "/games/" + names[index];
      for(const ext of exts){
        const file = base + ext;
        w.postMessage({file});
      }
      index++;
    }

    if(index < names.length){
      setTimeout(dispatch, 20);
    } else {
      loader.innerText = "Scan complete";
    }
  }

  dispatch();
}

/* ================================================================
     AUTO-PLAY LAST GAME
================================================================ */
const last = localStorage.getItem("lastGame");
if(last){
  setTimeout(()=>window.location.href = last, 1500);
}

/* ================================================================
     SETTINGS
================================================================ */
themeSelect.onchange = ()=>{
  document.body.className = themeSelect.value;
  localStorage.setItem("theme", themeSelect.value);
};

document.body.className = localStorage.getItem("theme") || "dark";

stopScan.onclick = ()=>{ scanning = false; loader.innerText = "Stopped"; };
rescan.onclick = ()=>location.reload();
clearDB.onclick = ()=>{
  localStorage.removeItem("puzzledDB");
  location.reload();
};

/* ================================================================
     START SCANNING
================================================================ */
startScan();
</script>

</body>
</html>
